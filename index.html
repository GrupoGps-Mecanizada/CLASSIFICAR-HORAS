<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Classifica√ß√£o de Extras</title>
    <meta name="theme-color" content="#1F4E78">
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        
        /* Autocomplete dropdown */
        .autocomplete-dropdown {
            position: absolute;
            background: white;
            border: 2px solid #3B82F6;
            border-radius: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #E5E7EB;
        }
        
        .autocomplete-item:hover, .autocomplete-item.selected {
            background: #DBEAFE;
        }
        
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        
        /* Print styles */
        @media print {
            body { background: white; }
            .no-print { display: none !important; }
            .print-container { 
                page-break-inside: avoid;
                margin: 10px;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div id="app"></div>

    <script>
        // ============================================
        // CONFIGURA√á√ÉO
        // ============================================
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwcurfCG2KDJRwjoRQc4e9tv8kFrEgdcOiFcJw924Gi0NApPMaoyvf9YWtm-UVS9k4X/exec';
        
        // ============================================
        // HOR√ÅRIOS DISPON√çVEIS
        // ============================================
        const HORARIOS = [
            { value: '07-19', label: '07:00 √†s 19:00 (12h)' },
            { value: '19-07', label: '19:00 √†s 07:00 (12h)' },
            { value: '07-15', label: '07:00 √†s 15:00 (8h)' },
            { value: '15-23', label: '15:00 √†s 23:00 (8h)' },
            { value: '23-07', label: '23:00 √†s 07:00 (8h)' },
            { value: '07-17', label: '07:00 √†s 17:00 (10h)' }
        ];

        // ============================================
        // TIPOS DE EXTRA
        // ============================================
        const TIPOS_EXTRA = [
            { value: 'COBRINDO', label: 'Cobrindo Aus√™ncia', needsCover: true },
            { value: 'SOLICITACAO_CLIENTE', label: 'Solicita√ß√£o do Cliente', needsCover: false },
            { value: 'OUTRO', label: 'Outro', needsCover: false, needsCustom: true }
        ];

        // ============================================
        // MOTIVOS DE COBRIMENTO
        // ============================================
        const MOTIVOS_COBRIMENTO = [
            'ATESTADO MEDICO',
            'FALTA',
            'FERIAS',
            'AFASTADO',
            'TREINAMENTO',
            'FOLGA',
            'LICEN√áA',
            'OUTRO'
        ];

        // ============================================
        // ESTADO DA APLICA√á√ÉO
        // ============================================
        let state = {
            view: 'login',
            supervisor: null,
            colaboradores: [],
            extras: [],
            isLoading: false,
            editingIndex: null,
            autocomplete: {
                active: null,
                selectedIndex: -1,
                filteredItems: []
            }
        };

        // ============================================
        // UTILIT√ÅRIOS
        // ============================================
        function getCurrentDate() {
            return new Date().toISOString().split('T')[0];
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('pt-BR', { 
                weekday: 'short', 
                day: '2-digit', 
                month: '2-digit',
                year: 'numeric'
            });
        }

        function getWeekday(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            const dias = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
            return dias[date.getDay()];
        }

        // ============================================
        // AUTOCOMPLETE
        // ============================================
        function initAutocomplete(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;

            input.addEventListener('input', (e) => handleAutocompleteInput(inputId, e.target.value));
            input.addEventListener('focus', (e) => handleAutocompleteInput(inputId, e.target.value));
            input.addEventListener('keydown', (e) => handleAutocompleteKeydown(inputId, e));
            
            // Fecha autocomplete ao clicar fora
            document.addEventListener('click', (e) => {
                if (!e.target.closest(`#${inputId}`) && !e.target.closest('.autocomplete-dropdown')) {
                    closeAutocomplete(inputId);
                }
            });
        }

        function handleAutocompleteInput(inputId, value) {
            const searchTerm = value.toLowerCase().trim();
            
            if (searchTerm.length < 2) {
                closeAutocomplete(inputId);
                return;
            }

            const filtered = state.colaboradores.filter(c => {
                const nome = c.nome.toLowerCase();
                const id = c.id.toLowerCase();
                return nome.includes(searchTerm) || id.includes(searchTerm);
            });

            state.autocomplete.active = inputId;
            state.autocomplete.filteredItems = filtered;
            state.autocomplete.selectedIndex = -1;

            showAutocomplete(inputId, filtered);
        }

        function showAutocomplete(inputId, items) {
            const input = document.getElementById(inputId);
            const existingDropdown = document.getElementById(`${inputId}-dropdown`);
            
            if (existingDropdown) {
                existingDropdown.remove();
            }

            if (items.length === 0) return;

            const dropdown = document.createElement('div');
            dropdown.id = `${inputId}-dropdown`;
            dropdown.className = 'autocomplete-dropdown';
            dropdown.style.width = input.offsetWidth + 'px';
            dropdown.style.top = (input.offsetTop + input.offsetHeight + 4) + 'px';
            dropdown.style.left = input.offsetLeft + 'px';

            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'autocomplete-item';
                div.innerHTML = `
                    <div class="font-semibold text-gray-800">${item.nome}</div>
                    <div class="text-xs text-gray-500">${item.funcao} ‚Ä¢ ${item.regime}</div>
                `;
                div.onclick = () => selectAutocompleteItem(inputId, item);
                dropdown.appendChild(div);
            });

            input.parentElement.style.position = 'relative';
            input.parentElement.appendChild(dropdown);
        }

        function selectAutocompleteItem(inputId, item) {
            const input = document.getElementById(inputId);
            input.value = item.nome;
            input.dataset.selectedId = item.id;
            input.dataset.selectedNome = item.nome;
            input.dataset.funcao = item.funcao;
            input.dataset.regime = item.regime;
            closeAutocomplete(inputId);
        }

        function handleAutocompleteKeydown(inputId, e) {
            const dropdown = document.getElementById(`${inputId}-dropdown`);
            if (!dropdown) return;

            const items = dropdown.querySelectorAll('.autocomplete-item');
            if (items.length === 0) return;

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                state.autocomplete.selectedIndex = Math.min(state.autocomplete.selectedIndex + 1, items.length - 1);
                updateAutocompleteSelection(items);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                state.autocomplete.selectedIndex = Math.max(state.autocomplete.selectedIndex - 1, -1);
                updateAutocompleteSelection(items);
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (state.autocomplete.selectedIndex >= 0) {
                    const selectedItem = state.autocomplete.filteredItems[state.autocomplete.selectedIndex];
                    selectAutocompleteItem(inputId, selectedItem);
                }
            } else if (e.key === 'Escape') {
                closeAutocomplete(inputId);
            }
        }

        function updateAutocompleteSelection(items) {
            items.forEach((item, index) => {
                item.classList.toggle('selected', index === state.autocomplete.selectedIndex);
                if (index === state.autocomplete.selectedIndex) {
                    item.scrollIntoView({ block: 'nearest' });
                }
            });
        }

        function closeAutocomplete(inputId) {
            const dropdown = document.getElementById(`${inputId}-dropdown`);
            if (dropdown) {
                dropdown.remove();
            }
            state.autocomplete.active = null;
            state.autocomplete.selectedIndex = -1;
        }

        // ============================================
        // SERVI√áOS / API
        // ============================================
        async function login(username) {
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=login&username=${encodeURIComponent(username)}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Erro no login:', error);
                return { success: false, error: error.message };
            }
        }

        async function getColaboradores() {
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getColaboradores`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Erro ao buscar colaboradores:', error);
                return { success: false, error: error.message };
            }
        }

        async function saveExtras(extras) {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'saveExtras', extras: extras })
                });
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Erro ao salvar extras:', error);
                return { success: false, error: error.message };
            }
        }

        // ============================================
        // L√ìGICA DE NEG√ìCIO
        // ============================================
        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();

            if (!username) {
                alert('Digite o nome do supervisor');
                return;
            }

            state.isLoading = true;
            render();

            const result = await login(username);

            if (result.success) {
                state.supervisor = result.supervisor;
                localStorage.setItem('supervisor', JSON.stringify(result.supervisor));
                await loadColaboradores();
                state.view = 'extras';
            } else {
                alert('Login falhou: ' + (result.error || 'Supervisor n√£o encontrado'));
            }

            state.isLoading = false;
            render();
        }

        async function loadColaboradores() {
            const result = await getColaboradores();
            if (result.success) {
                state.colaboradores = result.colaboradores;
            }
        }

        function addExtra() {
            const colaboradorInput = document.getElementById('colaborador');
            const data = document.getElementById('data').value;
            const horario = document.getElementById('horario').value;
            const tipo = document.getElementById('tipo').value;
            const tipoOutro = document.getElementById('tipo-outro')?.value || '';
            const cobriuInput = document.getElementById('cobriu');
            const motivo = document.getElementById('motivo')?.value || '';
            const motivoOutro = document.getElementById('motivo-outro')?.value || '';
            const observacao = document.getElementById('observacao').value;

            // Valida√ß√µes
            if (!colaboradorInput.dataset.selectedId || !data || !horario || !tipo) {
                alert('Preencha todos os campos obrigat√≥rios');
                return;
            }

            const tipoInfo = TIPOS_EXTRA.find(t => t.value === tipo);
            
            // Valida√ß√£o para tipo OUTRO
            if (tipoInfo.needsCustom && !tipoOutro.trim()) {
                alert('Especifique o tipo de extra');
                return;
            }

            // Valida√ß√£o para cobrimento
            if (tipoInfo.needsCover && !cobriuInput?.dataset.selectedId) {
                alert('Informe quem foi coberto');
                return;
            }

            // Valida√ß√£o para motivo OUTRO
            if (motivo === 'OUTRO' && !motivoOutro.trim()) {
                alert('Especifique o motivo do cobrimento');
                return;
            }

            const extra = {
                colaboradorId: colaboradorInput.dataset.selectedId,
                colaboradorNome: colaboradorInput.dataset.selectedNome,
                funcao: colaboradorInput.dataset.funcao,
                regime: colaboradorInput.dataset.regime,
                data: data,
                horario: horario,
                tipo: tipo === 'OUTRO' ? tipoOutro : tipo,
                cobriuId: cobriuInput?.dataset.selectedId || '',
                cobriuNome: cobriuInput?.dataset.selectedNome || '',
                motivo: motivo === 'OUTRO' ? motivoOutro : motivo,
                observacao: observacao,
                supervisor: state.supervisor.nome
            };

            if (state.editingIndex !== null) {
                state.extras[state.editingIndex] = extra;
                state.editingIndex = null;
            } else {
                state.extras.push(extra);
            }

            // Limpa formul√°rio
            document.getElementById('extra-form').reset();
            delete colaboradorInput.dataset.selectedId;
            delete colaboradorInput.dataset.selectedNome;
            delete colaboradorInput.dataset.funcao;
            delete colaboradorInput.dataset.regime;
            if (cobriuInput) {
                delete cobriuInput.dataset.selectedId;
                delete cobriuInput.dataset.selectedNome;
            }
            
            colaboradorInput.focus();
            render();
        }

        function editExtra(index) {
            const extra = state.extras[index];
            state.editingIndex = index;
            
            const colaboradorInput = document.getElementById('colaborador');
            colaboradorInput.value = extra.colaboradorNome;
            colaboradorInput.dataset.selectedId = extra.colaboradorId;
            colaboradorInput.dataset.selectedNome = extra.colaboradorNome;
            colaboradorInput.dataset.funcao = extra.funcao;
            colaboradorInput.dataset.regime = extra.regime;
            
            document.getElementById('data').value = extra.data;
            document.getElementById('horario').value = extra.horario;
            
            // Verifica se √© tipo customizado
            const tipoExists = TIPOS_EXTRA.find(t => t.value === extra.tipo);
            if (tipoExists) {
                document.getElementById('tipo').value = extra.tipo;
            } else {
                document.getElementById('tipo').value = 'OUTRO';
                setTimeout(() => {
                    document.getElementById('tipo-outro').value = extra.tipo;
                }, 100);
            }
            
            handleTipoChange();
            
            if (extra.cobriuId) {
                const cobriuInput = document.getElementById('cobriu');
                cobriuInput.value = extra.cobriuNome;
                cobriuInput.dataset.selectedId = extra.cobriuId;
                cobriuInput.dataset.selectedNome = extra.cobriuNome;
            }
            
            if (extra.motivo) {
                const motivoExists = MOTIVOS_COBRIMENTO.includes(extra.motivo);
                if (motivoExists) {
                    document.getElementById('motivo').value = extra.motivo;
                } else {
                    document.getElementById('motivo').value = 'OUTRO';
                    setTimeout(() => {
                        document.getElementById('motivo-outro').value = extra.motivo;
                    }, 100);
                }
                handleMotivoChange();
            }
            
            document.getElementById('observacao').value = extra.observacao;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function removeExtra(index) {
            if (confirm('Remover este registro de extra?')) {
                state.extras.splice(index, 1);
                render();
            }
        }

        function cancelEdit() {
            state.editingIndex = null;
            document.getElementById('extra-form').reset();
            const colaboradorInput = document.getElementById('colaborador');
            delete colaboradorInput.dataset.selectedId;
            delete colaboradorInput.dataset.selectedNome;
            delete colaboradorInput.dataset.funcao;
            delete colaboradorInput.dataset.regime;
            render();
        }

        function handleTipoChange() {
            const tipo = document.getElementById('tipo').value;
            const tipoInfo = TIPOS_EXTRA.find(t => t.value === tipo);
            
            const coverFields = document.getElementById('cover-fields');
            const customTipoField = document.getElementById('custom-tipo-field');
            
            if (coverFields) {
                coverFields.style.display = tipoInfo && tipoInfo.needsCover ? 'block' : 'none';
            }
            
            if (customTipoField) {
                customTipoField.style.display = tipoInfo && tipoInfo.needsCustom ? 'block' : 'none';
            }
        }

        function handleMotivoChange() {
            const motivo = document.getElementById('motivo')?.value;
            const customMotivoField = document.getElementById('custom-motivo-field');
            
            if (customMotivoField) {
                customMotivoField.style.display = motivo === 'OUTRO' ? 'block' : 'none';
            }
        }

        async function saveAllExtras() {
            if (state.extras.length === 0) {
                alert('Nenhuma extra para salvar');
                return;
            }

            if (!confirm(`Salvar ${state.extras.length} registro(s) de extra?`)) {
                return;
            }

            state.isLoading = true;
            render();

            const result = await saveExtras(state.extras);

            if (result.success) {
                alert(`‚úÖ ${state.extras.length} registro(s) salvos com sucesso!`);
                state.extras = [];
                document.getElementById('extra-form').reset();
            } else {
                alert('Erro ao salvar: ' + result.error);
            }

            state.isLoading = false;
            render();
        }

        function handleLogout() {
            if (state.extras.length > 0) {
                if (!confirm('Voc√™ tem extras n√£o salvos. Deseja realmente sair?')) {
                    return;
                }
            }
            localStorage.removeItem('supervisor');
            state.supervisor = null;
            state.colaboradores = [];
            state.extras = [];
            state.view = 'login';
            render();
        }

        function copyExtrasToClipboard() {
            let text = `üìã *REGISTRO DE EXTRAS*\n`;
            text += `üë§ Supervisor: ${state.supervisor.nome}\n`;
            text += `üìÖ Data: ${formatDate(getCurrentDate())}\n`;
            text += `üìä Total: ${state.extras.length} registro(s)\n\n`;
            text += `${'='.repeat(40)}\n\n`;

            state.extras.forEach((extra, index) => {
                text += `*#${index + 1} - ${extra.colaboradorNome}*\n`;
                text += `‚îú Fun√ß√£o: ${extra.funcao} | Regime: ${extra.regime}\n`;
                text += `‚îú Data: ${formatDate(extra.data)}\n`;
                text += `‚îú Hor√°rio: ${HORARIOS.find(h => h.value === extra.horario)?.label || extra.horario}\n`;
                text += `‚îú Tipo: ${extra.tipo}\n`;
                if (extra.cobriuNome) {
                    text += `‚îú Cobriu: ${extra.cobriuNome}\n`;
                    if (extra.motivo) text += `‚îú Motivo: ${extra.motivo}\n`;
                }
                if (extra.observacao) {
                    text += `‚îî Obs: ${extra.observacao}\n`;
                }
                text += `\n`;
            });

            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Relat√≥rio copiado! Cole no WhatsApp.');
            }).catch(() => {
                alert('‚ùå Erro ao copiar. Tente novamente.');
            });
        }

        // ============================================
        // RENDERIZA√á√ÉO
        // ============================================
        function render() {
            const app = document.getElementById('app');
            
            switch(state.view) {
                case 'login':
                    app.innerHTML = renderLogin();
                    break;
                case 'extras':
                    app.innerHTML = renderExtras();
                    setTimeout(() => {
                        initAutocomplete('colaborador');
                        initAutocomplete('cobriu');
                        handleTipoChange();
                    }, 0);
                    break;
            }
        }

        function renderLogin() {
            return `
                <div class="min-h-screen flex flex-col justify-center items-center p-6 bg-gradient-to-br from-blue-900 to-blue-700">
                    <div class="bg-white p-8 rounded-2xl w-full max-w-sm shadow-2xl fade-in">
                        <div class="flex justify-center mb-6 text-blue-900">
                            <i class="ph-fill ph-clock-afternoon text-7xl"></i>
                        </div>
                        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">Classifica√ß√£o de Extras</h1>
                        <p class="text-center text-gray-500 mb-8 text-sm">Sistema de Registro de Horas Extras</p>
                        
                        <form onsubmit="handleLogin(event)" class="space-y-6">
                            <div>
                                <label class="text-sm font-bold text-gray-700 block mb-2 uppercase">Supervisor</label>
                                <input 
                                    type="text" 
                                    id="username"
                                    class="w-full border-2 border-gray-300 rounded-lg p-4 focus:border-blue-600 outline-none text-lg"
                                    placeholder="Digite seu nome"
                                    ${state.isLoading ? 'disabled' : ''}
                                    autocomplete="off"
                                    required
                                >
                            </div>
                            
                            <button 
                                type="submit" 
                                class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-blue-700 transition-all flex items-center justify-center gap-2"
                                ${state.isLoading ? 'disabled' : ''}
                            >
                                ${state.isLoading ? '<i class="ph ph-spinner animate-spin text-2xl"></i> ENTRANDO...' : '<i class="ph ph-sign-in text-xl"></i> ENTRAR'}
                            </button>
                        </form>
                        
                        <div class="mt-6 text-center text-xs text-gray-400">
                            <p>Vers√£o 2.0 | ¬© 2026</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderExtras() {
            const totalExtras = state.extras.length;

            return `
                <div class="min-h-screen bg-gray-50 pb-24">
                    <!-- Header -->
                    <header class="bg-gradient-to-r from-blue-900 to-blue-700 text-white p-4 sticky top-0 z-30 shadow-lg no-print">
                        <div class="flex justify-between items-center">
                            <div>
                                <h1 class="font-bold text-xl">Registro de Extras</h1>
                                <p class="text-sm opacity-90">${state.supervisor.nome}</p>
                            </div>
                            <button onclick="handleLogout()" class="p-2 rounded-full hover:bg-white/20 transition-all">
                                <i class="ph ph-sign-out text-2xl"></i>
                            </button>
                        </div>
                        
                        <!-- Contador -->
                        <div class="mt-3 bg-white/10 rounded-lg p-3 backdrop-blur-sm text-center">
                            <div class="text-3xl font-black">${totalExtras}</div>
                            <div class="text-xs opacity-75">Extras Registrados</div>
                        </div>
                    </header>

                    <!-- Formul√°rio -->
                    <main class="p-4 max-w-2xl mx-auto">
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in no-print">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                                    <i class="ph-fill ph-plus-circle text-2xl text-blue-600"></i>
                                </div>
                                <div>
                                    <h2 class="font-bold text-xl text-gray-800">
                                        ${state.editingIndex !== null ? 'Editar Extra' : 'Nova Extra'}
                                    </h2>
                                    <p class="text-sm text-gray-500">Preencha os dados abaixo</p>
                                </div>
                            </div>

                            <form id="extra-form" onsubmit="event.preventDefault(); addExtra();" class="space-y-4">
                                <!-- Colaborador com Autocomplete -->
                                <div>
                                    <label class="text-sm font-bold text-gray-700 block mb-2">
                                        <i class="ph ph-user text-blue-600"></i> Colaborador *
                                    </label>
                                    <input
                                        type="text"
                                        id="colaborador"
                                        class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 outline-none"
                                        placeholder="Digite para buscar..."
                                        autocomplete="off"
                                        required
                                    >
                                </div>

                                <!-- Data e Hor√°rio -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm font-bold text-gray-700 block mb-2">
                                            <i class="ph ph-calendar text-blue-600"></i> Data *
                                        </label>
                                        <input 
                                            type="date"
                                            id="data"
                                            value="${getCurrentDate()}"
                                            class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 outline-none"
                                            required
                                        >
                                    </div>
                                    
                                    <div>
                                        <label class="text-sm font-bold text-gray-700 block mb-2">
                                            <i class="ph ph-clock text-blue-600"></i> Hor√°rio *
                                        </label>
                                        <select 
                                            id="horario"
                                            class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 outline-none"
                                            required
                                        >
                                            <option value="">Selecione...</option>
                                            ${HORARIOS.map(h => `
                                                <option value="${h.value}">${h.label}</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                </div>

                                <!-- Tipo -->
                                <div>
                                    <label class="text-sm font-bold text-gray-700 block mb-2">
                                        <i class="ph ph-tag text-blue-600"></i> Tipo de Extra *
                                    </label>
                                    <select 
                                        id="tipo"
                                        onchange="handleTipoChange()"
                                        class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 outline-none"
                                        required
                                    >
                                        <option value="">Selecione...</option>
                                        ${TIPOS_EXTRA.map(t => `
                                            <option value="${t.value}">${t.label}</option>
                                        `).join('')}
                                    </select>
                                </div>

                                <!-- Campo customizado para tipo OUTRO -->
                                <div id="custom-tipo-field" style="display: none;">
                                    <label class="text-sm font-bold text-gray-700 block mb-2">
                                        <i class="ph ph-pencil text-blue-600"></i> Especifique o Tipo *
                                    </label>
                                    <input
                                        type="text"
                                        id="tipo-outro"
                                        class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 outline-none"
                                        placeholder="Digite o tipo de extra"
                                        autocomplete="off"
                                    >
                                </div>

                                <!-- Campos Condicionais para Cobrimento -->
                                <div id="cover-fields" style="display: none;" class="space-y-4 p-4 bg-yellow-50 rounded-lg border-2 border-yellow-200">
                                    <div>
                                        <label class="text-sm font-bold text-gray-700 block mb-2">
                                            <i class="ph ph-user-switch text-yellow-600"></i> Quem foi coberto? *
                                        </label>
                                        <input
                                            type="text"
                                            id="cobriu"
                                            class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 outline-none"
                                            placeholder="Digite para buscar..."
                                            autocomplete="off"
                                        >
                                    </div>
                                    
                                    <div>
                                        <label class="text-sm font-bold text-gray-700 block mb-2">
                                            <i class="ph ph-info text-yellow-600"></i> Motivo do Cobrimento
                                        </label>
                                        <select 
                                            id="motivo"
                                            onchange="handleMotivoChange()"
                                            class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 outline-none"
                                        >
                                            <option value="">Selecione...</option>
                                            ${MOTIVOS_COBRIMENTO.map(m => `
                                                <option value="${m}">${m}</option>
                                            `).join('')}
                                        </select>
                                    </div>

                                    <!-- Campo customizado para motivo OUTRO -->
                                    <div id="custom-motivo-field" style="display: none;">
                                        <label class="text-sm font-bold text-gray-700 block mb-2">
                                            <i class="ph ph-pencil text-yellow-600"></i> Especifique o Motivo *
                                        </label>
                                        <input
                                            type="text"
                                            id="motivo-outro"
                                            class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 outline-none"
                                            placeholder="Digite o motivo"
                                            autocomplete="off"
                                        >
                                    </div>
                                </div>

                                <!-- Observa√ß√£o -->
                                <div>
                                    <label class="text-sm font-bold text-gray-700 block mb-2">
                                        <i class="ph ph-note text-blue-600"></i> Observa√ß√£o
                                    </label>
                                    <textarea 
                                        id="observacao"
                                        class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 outline-none resize-none"
                                        rows="2"
                                        placeholder="Informa√ß√µes adicionais (opcional)"
                                    ></textarea>
                                </div>

                                <!-- Bot√µes -->
                                <div class="flex gap-3 pt-2">
                                    ${state.editingIndex !== null ? `
                                        <button 
                                            type="button"
                                            onclick="cancelEdit()"
                                            class="flex-1 bg-gray-500 text-white font-bold py-3 rounded-lg hover:bg-gray-600 transition-all"
                                        >
                                            <i class="ph ph-x"></i> Cancelar
                                        </button>
                                    ` : ''}
                                    <button 
                                        type="submit"
                                        class="flex-1 bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-all shadow-lg"
                                    >
                                        <i class="ph ph-${state.editingIndex !== null ? 'check' : 'plus'}"></i> 
                                        ${state.editingIndex !== null ? 'Atualizar' : 'Adicionar'}
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Lista de Extras -->
                        ${state.extras.length > 0 ? `
                            <div class="space-y-3 print-container">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="font-bold text-lg text-gray-800">
                                        <i class="ph-fill ph-list text-blue-600"></i> 
                                        Extras Registrados (${state.extras.length})
                                    </h3>
                                    <button 
                                        onclick="copyExtrasToClipboard()"
                                        class="no-print bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all flex items-center gap-2 text-sm font-semibold"
                                    >
                                        <i class="ph ph-copy text-lg"></i>
                                        Copiar p/ WhatsApp
                                    </button>
                                </div>
                                
                                ${state.extras.map((extra, index) => renderExtraCard(extra, index)).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-12 bg-white rounded-xl shadow-sm no-print">
                                <i class="ph ph-clipboard-text text-6xl text-gray-300 mb-4"></i>
                                <p class="text-gray-500">Nenhuma extra registrada ainda</p>
                                <p class="text-sm text-gray-400 mt-2">Preencha o formul√°rio acima para come√ßar</p>
                            </div>
                        `}
                    </main>

                    <!-- Fixed Bottom Bar -->
                    ${state.extras.length > 0 ? `
                        <div class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 p-4 shadow-lg no-print">
                            <button 
                                onclick="saveAllExtras()"
                                ${state.isLoading ? 'disabled' : ''}
                                class="w-full max-w-2xl mx-auto block bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed hover:bg-blue-700 transition-all flex items-center justify-center gap-2"
                            >
                                ${state.isLoading ? '<i class="ph ph-spinner animate-spin text-2xl"></i> SALVANDO...' : `<i class="ph ph-floppy-disk text-2xl"></i> SALVAR ${state.extras.length} REGISTRO(S)`}
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderExtraCard(extra, index) {
            const horarioInfo = HORARIOS.find(h => h.value === extra.horario);
            
            return `
                <div class="bg-white rounded-xl shadow-md p-5 border-l-4 border-blue-500 slide-up print-container">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <h4 class="font-bold text-lg text-gray-800 mb-1">${extra.colaboradorNome}</h4>
                            <div class="flex gap-2 flex-wrap mb-2">
                                <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full font-semibold">
                                    ${extra.funcao}
                                </span>
                                <span class="text-xs px-2 py-1 bg-purple-100 text-purple-800 rounded-full font-semibold">
                                    ${extra.regime}
                                </span>
                            </div>
                        </div>
                        <div class="flex gap-2 no-print">
                            <button 
                                onclick="editExtra(${index})"
                                class="p-2 rounded-lg bg-yellow-100 text-yellow-700 hover:bg-yellow-200 transition-all"
                            >
                                <i class="ph ph-pencil text-lg"></i>
                            </button>
                            <button 
                                onclick="removeExtra(${index})"
                                class="p-2 rounded-lg bg-red-100 text-red-700 hover:bg-red-200 transition-all"
                            >
                                <i class="ph ph-trash text-lg"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="flex items-center gap-2">
                            <i class="ph-fill ph-calendar text-blue-600"></i>
                            <div>
                                <div class="text-gray-500 text-xs">Data</div>
                                <div class="font-semibold">${formatDate(extra.data)}</div>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <i class="ph-fill ph-clock text-blue-600"></i>
                            <div>
                                <div class="text-gray-500 text-xs">Hor√°rio</div>
                                <div class="font-semibold">${horarioInfo ? horarioInfo.label : extra.horario}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <div class="flex items-start gap-2 mb-2">
                            <i class="ph-fill ph-tag text-green-600 mt-1"></i>
                            <div class="flex-1">
                                <div class="text-gray-500 text-xs">Tipo</div>
                                <div class="font-semibold text-green-700">${extra.tipo}</div>
                            </div>
                        </div>
                        
                        ${extra.cobriuNome ? `
                            <div class="flex items-start gap-2 mb-2 bg-yellow-50 p-2 rounded-lg">
                                <i class="ph-fill ph-user-switch text-yellow-600 mt-1"></i>
                                <div class="flex-1">
                                    <div class="text-gray-500 text-xs">Cobriu</div>
                                    <div class="font-semibold">${extra.cobriuNome}</div>
                                    ${extra.motivo ? `<div class="text-xs text-gray-600 mt-1">Motivo: ${extra.motivo}</div>` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${extra.observacao ? `
                            <div class="flex items-start gap-2 mt-2">
                                <i class="ph-fill ph-note text-gray-600 mt-1"></i>
                                <div class="flex-1">
                                    <div class="text-gray-500 text-xs">Observa√ß√£o</div>
                                    <div class="text-sm text-gray-700">${extra.observacao}</div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            const savedSupervisor = localStorage.getItem('supervisor');
            if (savedSupervisor) {
                state.supervisor = JSON.parse(savedSupervisor);
                loadColaboradores().then(() => {
                    state.view = 'extras';
                    render();
                });
            } else {
                render();
            }
        });
    </script>
</body>
</html>
